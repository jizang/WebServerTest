@{
    ViewData["Title"] = "產品列表";
}

@section Styles {
    <link rel="stylesheet" href="/lib/datatables.net-bs5/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="/lib/sweetalert2/sweetalert2.min.css">
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>產品管理</h2>
        <a asp-action="Create" class="btn btn-primary">
            <i class="fa fa-plus"></i> 新增產品
        </a>
    </div>

    <table id="productTable" class="display table table-striped table-hover" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>產品名稱</th>
                <th>類別</th>
                <th>供應商</th>
                <th>單價</th>
                <th>庫存</th>
                <th>狀態</th>
                <th>功能</th>
            </tr>
        </thead>
    </table>
</div>

@section Scripts {
    <script src="/lib/datatables.net/dataTables.min.js"></script>
    <script src="/lib/datatables.net-bs5/dataTables.bootstrap5.min.js"></script>
    <script src="/lib/sweetalert2/sweetalert2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#productTable').DataTable({
                "ajax": {
                    "url": "/Product/GetProductsJson",
                    "type": "GET",
                    "datatype": "json"
                },
                // 欄位對應 Controller 的匿名物件屬性 (camelCase)
                "columns": [
                    { "data": "productID", "width": "5%" },
                    { "data": "productName", "width": "20%", "className": "fw-bold",
                              "render": function (e) {
                               return e ? e.replace('C', '*') : e;
                        }  },
                    { "data": "categoryName", "width": "12%" },
                    { "data": "supplierName", "width": "15%" },
                    {
                        "data": "unitPrice",
                        "width": "10%",
                        "render": function (data) {
                            return data ? `$${parseFloat(data).toFixed(2)}` : '$0.00';
                        }
                    },
                    { "data": "unitsInStock", "width": "8%", "className": "text-center" },
                    {
                        "data": "discontinued",
                        "width": "10%",
                        "className": "text-center",
                        "render": function (data) {
                            return data ? '<span class="badge bg-danger">已停產</span>' : '<span class="badge bg-success">銷售中</span>';
                        }
                    },
                    {
                        "data": "productID",
                        "width": "20%",
                        "orderable": false,
                        "render": function (data) {
                            return `
                                <div class="btn-group" role="group">
                                    <a href="/Product/Edit/${data}" class="btn btn-sm btn-warning text-white">編輯</a>
                                </div>
                            `;
                        }
                    }
                ],
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/2.3.4/i18n/zh-HANT.json"
                }
            });
        });
    </script>
}
